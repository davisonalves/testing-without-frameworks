
# Como contribuir

[![Continuous Delivery](https://github.com/ServeRest/ServeRest/actions/workflows/continuous_delivery.yml/badge.svg)](https://github.com/ServeRest/ServeRest/actions/workflows/continuous_delivery.yml)
[![Deploy ServeRest on the web](https://github.com/ServeRest/ServeRest/actions/workflows/deploy-online-serverest.yml/badge.svg)](https://github.com/ServeRest/ServeRest/actions/workflows/deploy-online-serverest.yml)
[![Continuous Integration](https://github.com/ServeRest/ServeRest/actions/workflows/continuous_integration.yml/badge.svg)](https://github.com/ServeRest/ServeRest/actions/workflows/continuous_integration.yml)

[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=ServeRest&metric=alert_status)](https://sonarcloud.io/dashboard?id=ServeRest)
[![Pact Status](https://paulogoncalves.pactflow.io/pacts/provider/ServeRest%20-%20API%20Rest/consumer/Front/latest/badge.svg)](https://paulogoncalves.pactflow.io/)

[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=ServeRest&metric=coverage)](https://sonarcloud.io/dashboard?id=ServeRest)
[![Mutation testing badge](https://img.shields.io/endpoint?style=flat&url=https%3A%2F%2Fbadge-api.stryker-mutator.io%2Fgithub.com%2FServeRest%2FServeRest%2Ftrunk)](https://dashboard.stryker-mutator.io/reports/github.com/ServeRest/ServeRest/trunk)

[![semantic-release](https://img.shields.io/badge/%20%20%F0%9F%93%A6%F0%9F%9A%80-semantic--release-e10079.svg)](https://github.com/semantic-release/semantic-release)
[![Commitizen friendly](https://img.shields.io/badge/commitizen-friendly-brightgreen.svg)](http://commitizen.github.io/cz-cli/)
[![JavaScript Style Guide](https://img.shields.io/badge/code_style-standard-brightgreen.svg)](https://standardjs.com)
[![Conventional Commits](https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg)](https://conventionalcommits.org)

---

**Esse documento apresenta todas as informaÃ§Ãµes necessÃ¡rias para que possa colaborar com o projeto de forma independente.**

VocÃª pode contribuir de vÃ¡rias maneiras, sendo as mais conhecidas as seguintes:

- Localizando e relatando bugs
- Sugerindo melhorias
- Tirando dÃºvidas dos outros usuÃ¡rios
- Corrigindo bugs ou implementando novos recursos
- Melhorando a documentaÃ§Ã£o
- Traduzindo a documentaÃ§Ã£o
- Melhorando a estrutura do cÃ³digo

## Importante

1. NÃ£o tenha receio em contribuir se achar muito complexo as etapas para contribuir. **Basta pedir apoio em issue ou PR e receberÃ¡ auxÃ­lio no que precisar.**
1. Se estÃ¡ fazendo algum ajuste e estÃ¡ com dificuldades (Ex.: teste quebrando, dificuldade de criar novos testes, falta de entendimento de alguma regra de negÃ³cio, etc) tambÃ©m nÃ£o tenha receios em pedir auxÃ­lio.

## SumÃ¡rio
- [ExecuÃ§Ã£o do projeto](#execuÃ§Ã£o-do-projeto)
- [Etapas para contribuir](#etapas-para-contribuir)
- [Garantindo a qualidade do projeto](#garantindo-a-qualidade-do-projeto)
    - [Legenda](#legenda)
    - [ðŸ’¥ðŸ’» Testes](#-testes)
        - [ðŸ’¥ðŸ’» Cobertura de cÃ³digo](#-cobertura-de-cÃ³digo)
    - [ðŸ’¥ Testes de MutaÃ§Ã£o](#-testes-de-mutaÃ§Ã£o)
    - [ðŸ’¥ Teste de infra](#-teste-de-infra)
    - [ðŸ’¥ðŸ’» Lint](#-lint)
    - [ðŸ’¥ðŸ’» Commit](#-commit)
    - [ðŸ’¥ Dockerfile lint](#-dockerfile-lint)
- [Entrega contÃ­nua](#entrega-contÃ­nua)
- [DocumentaÃ§Ã£o](#documentaÃ§Ã£o)
- [Reconhecimento de contribuiÃ§Ã£o](#reconhecimento-de-contribuiÃ§Ã£o)

## PrÃ©-requisitos

Ã‰ preciso ter os seguintes programas instalados:

- [Git](https://git-scm.com/downloads)
- _(opcional)_ [Node.js](https://nodejs.org/pt-br/download/), preferencialmente versÃ£o LTS.
    - Se usar docker nÃ£o serÃ¡ preciso instalar o Node
- [Docker](https://www.docker.com/get-started)
- [Docker compose](https://docs.docker.com/compose/install/)

> Docker e Docker-compose sÃ£o utilizados para execuÃ§Ã£o dos testes e do projeto

## ExecuÃ§Ã£o do projeto

Com intuito de facilitar o desenvolvimento o projeto estÃ¡ todo dentro de container e sua execuÃ§Ã£o Ã© feita utilizando o arquivo [Makefile](../Makefile).

Utilize o seguinte comando para executar o projeto enquanto desenvolve para utilizar a funcionalidade de reiniciar a aplicaÃ§Ã£o a cada alteraÃ§Ã£o:

```sh
make run-dev
```

## Etapas para contribuir

1. [Fork](https://help.github.com/articles/fork-a-repo/) este repositÃ³rio para sua prÃ³pria conta GitHub, [clone](https://help.github.com/articles/cloning-a-repository/) no seu computador e, em seguida, acesse o diretÃ³rio criado;
1. FaÃ§a as alteraÃ§Ãµes necessÃ¡rias;
1. FaÃ§a o seu commit usando `npm run commit` _(opcional)_
1. Envie um [pull request](https://help.github.com/articles/about-pull-requests/);
1. Aguarde o resultado das validaÃ§Ãµes realizadas na integraÃ§Ã£o contÃ­nua. Caso haja alguma quebra, analise e faÃ§a as correÃ§Ãµes necessÃ¡rias.

## Garantindo a qualidade do projeto

Para o projeto manter a qualidade sÃ£o feitas diversas validaÃ§Ãµes, aonde Ã© validado a estrutura do projeto, a imagem docker, teste das regras de negÃ³cio, contrato entre front e back, teste E2E em staging, teste de fumaÃ§a em produÃ§Ã£o, mensagem de commit, etc.

Todas essas etapas sÃ£o muito importantes para que tenhamos confianÃ§a na qualidade das alteraÃ§Ãµes com o mÃ­nimo de intervenÃ§Ã£o humana, permitindo rÃ¡pida entrega do seu Pull Request para produÃ§Ã£o.

> Aqui amamos automaÃ§Ã£o, basta mergear o seu PR para a branch principal que a release serÃ¡ criada e totalmente validada.

### Legenda
#### ðŸ’¥ > ValidaÃ§Ã£o realizada na integraÃ§Ã£o contÃ­nua e entrega contÃ­nua
#### ðŸ’» > ValidaÃ§Ã£o realizada localmente

### ðŸ’¥ðŸ’» Testes

Os testes sÃ£o importantes para garantir a integridade do projeto a cada alteraÃ§Ã£o realizada. Ã‰ importante que atente de que a sua alteraÃ§Ã£o necessite de novos testes ou adequaÃ§Ã£o nos jÃ¡ existentes.

Os testes sÃ£o executados com [mocha](https://www.npmjs.com/package/mocha), validados com [chai](https://www.npmjs.com/package/chai), mockados com [sinon.js](https://www.npmjs.com/package/sinon) e [nock](https://www.npmjs.com/package/nock) e as requests sÃ£o feitas com [supertest](https://www.npmjs.com/package/supertest).

Para rodar os testes, execute:

1. `make test-integration` para os testes de integraÃ§Ã£o.
1. `make test-e2e-localhost` para os testes E2E em cima da imagem docker que irÃ¡ para produÃ§Ã£o.
1. `make test-unit` para os testes unitÃ¡rios.

_Execute o comando `make test` para rodar os testes unitÃ¡rios e de integraÃ§Ã£o._

> O commit Ã© abortado caso os testes unitÃ¡rios e de integraÃ§Ã£o nÃ£o resultem em sucesso

### ðŸ’¥ðŸ’» Cobertura de cÃ³digo

[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=ServeRest&metric=coverage)](https://sonarcloud.io/dashboard?id=ServeRest)

Usamos o [nyc](https://www.npmjs.com/package/nyc) para validar a cobertura de cÃ³digo.

Ã‰ importante que todo o cÃ³digo esteja com 100% de cobertura para podermos ter seguranÃ§a que toda alteraÃ§Ã£o no cÃ³digo serÃ¡ validada.

Para validar a cobertura localmente execute os testes. Ã‰ apresentado um report no terminal informando a cobertura de todos os arquivos em `/src`. Se algum dos arquivos nÃ£o estiver com 100% em todas as mÃ©tricas crie os testes necessÃ¡rios.

> Apenas os testes de integraÃ§Ã£o e unitÃ¡rios possuem coleta de cobertura de cÃ³digo.

### ðŸ’¥ Testes de MutaÃ§Ã£o

[![Mutation testing badge](https://img.shields.io/endpoint?style=flat&url=https%3A%2F%2Fbadge-api.stryker-mutator.io%2Fgithub.com%2FServeRest%2FServeRest%2Ftrunk)](https://dashboard.stryker-mutator.io/reports/github.com/ServeRest/ServeRest/trunk)

O teste de mutaÃ§Ã£o garante que os testes de API sÃ£o efetivos e complementa a [cobertura de cÃ³digo](#-cobertura-de-cÃ³digo).

A lib utilizada Ã© a [Stryker](http://stryker-mutator.io/).

Para rodar os testes de mutaÃ§Ã£o, execute o comando `make test-mutation`.

Para aprofundar sobre como funciona os testes de mutaÃ§Ã£o, leia o meu texto '[Teste de mutaÃ§Ã£o ðŸ‘½: O que Ã© e como fica a cobertura de cÃ³digo?](https://github.com/PauloGoncalvesBH/teste-de-mutacao)'.

> [Clique aqui para ver o dashboard do teste de mutaÃ§Ã£o.](https://dashboard.stryker-mutator.io/reports/github.com/ServeRest/ServeRest/trunk)

### ðŸ’¥ Teste de infra

[![Go Reference](https://pkg.go.dev/badge/github.com/gruntwork-io/terratest.svg)](https://pkg.go.dev/github.com/gruntwork-io/terratest)

Ã‰ utilizado o [Terratest](https://terratest.gruntwork.io/) para realizar teste de infraestrutura, validando comportamento da imagem docker durante sua execuÃ§Ã£o.

Para rodar o teste de infra e validar o `docker build` de produÃ§Ã£o, execute o comando `make test-infra`.

> Para saber mais sobre teste de infraestrutura recomendo o texto [What Is Infrastructure Testing And Why Is It Needed](https://www.softwaretestinghelp.com/infrastructure-testing-tutorial/).

### ðŸ’¥ðŸ’» Lint

[![JavaScript Style Guide](https://img.shields.io/badge/code_style-standard-brightgreen.svg)](https://standardjs.com)

Usamos o [standard](https://www.npmjs.com/package/standard) como linter e formatter do cÃ³digo e [lint-staged](https://www.npmjs.com/package/lint-staged) para forÃ§ar lint das alteraÃ§Ãµes que estÃ£o em staged do git.

Execute `npm run lint` para padronizar os arquivos.

Execute `npm run lint:fix` para corrigir automaticamente os problemas encontrados pelo lint.

> O commit Ã© abortado caso esse padrÃ£o nÃ£o seja seguido

### ðŸ’¥ðŸ’» Commit

[![Commitizen friendly](https://img.shields.io/badge/commitizen-friendly-brightgreen.svg)](http://commitizen.github.io/cz-cli/)
[![Conventional Commits](https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg)](https://conventionalcommits.org)

As mensagens de commit devem seguir o padrÃ£o do _conventional commit_.

Para saber mais, acesse esses links:
- [EspecificaÃ§Ã£o do Conventional Commit](https://www.conventionalcommits.org/)
- [Regras do @commitlint/config-conventional](https://github.com/conventional-changelog/commitlint/tree/master/%40commitlint/config-conventional).

Execute `npm run commit` para ter um painel interativo que permite seguir o padrÃ£o de commit de forma fÃ¡cil.

> O commit Ã© abortado caso esse padrÃ£o nÃ£o seja seguido

### ðŸ’¥ Dockerfile lint

Ã‰ utilizado o linter [Hadolint - Haskell Dockerfile Linter](https://github.com/hadolint/hadolint) para garantir que os Dockerfile de [produÃ§Ã£o](../Dockerfile), [desenvolvimento, teste](../Dockerfile.dev) e de [teste de infra](../Dockerfile) seguem as melhores prÃ¡ticas em sua estrutura.

---

## Entrega contÃ­nua

[![semantic-release](https://img.shields.io/badge/%20%20%F0%9F%93%A6%F0%9F%9A%80-semantic--release-e10079.svg)](https://github.com/semantic-release/semantic-release)

A publicaÃ§Ã£o de novas versÃµes no [NPM](https://www.npmjs.com/package/serverest), no [Docker](https://hub.docker.com/r/paulogoncalvesbh/serverest) e no [serverest.dev](https://serverest.dev/) Ã© feita automaticamente apÃ³s a execuÃ§Ã£o com sucesso de todas as etapas da pipeline de [entrega contÃ­nua](./workflows/continuous_delivery.yml).

Ã‰ utilizada a lib [Semantic-release](https://github.com/semantic-release/semantic-release) com personalizaÃ§Ãµes no arquivo [.releaserc.js](../.releaserc.js).

| NPM dist-tag | branch |
|:---:|:---:
| @latest | master
| @beta | beta

Para ver todo o passo a passo da entrega contÃ­nua, como deploy em staging e produÃ§Ã£o, testes E2E em staging e produÃ§Ã£o e rollback automÃ¡tico se algum erro for detectado, acesse: https://github.com/ServeRest/ServeRest/actions/workflows/deploy-online-serverest.yml

Para aprofundar sobre como Ã© feita a publicaÃ§Ã£o do _ServeRest_, leia o texto '[Entrega contÃ­nua no ServeRest](https://github.com/PauloGoncalvesBH/entrega-continua-no-serverest)'. _(desatualizado)_

## DocumentaÃ§Ã£o

A documentaÃ§Ã£o, disponibilizada nas URLs <https://serverest.dev> e <http://localhost:3000>, Ã© editada no arquivo [swagger.json](../docs/swagger.json).

Para atualizar:
1. Acesse o arquivo [swagger.json](../docs/swagger.json) e o edite de acordo com sua necessidade.
1. Execute o comando `make run-dev` para acompanhar o status da documentaÃ§Ã£o alterada na URL <http://localhost:3000>.

## Reconhecimento de contribuiÃ§Ã£o

<!-- ALL-CONTRIBUTORS-BADGE:START - Do not remove or modify this section -->
![All Contributors](https://img.shields.io/badge/all_contributors-13-orange.svg?style=for-the-badge)
<!-- ALL-CONTRIBUTORS-BADGE:END -->

Todos aqueles que contribuÃ­ram com o projeto, independente do tipo de contribuiÃ§Ã£o, devem ser reconhecidos.

Por isso, utilizamos o bot [@all-contributors](https://allcontributors.org/docs/en/bot/overview), que cria um Pull Request atualizando a seÃ§Ã£o de [contribuidores no README](../README.md/#contributors-).

Para entender como utilizar, basta acessar as [intruÃ§Ãµes de uso do bot](https://allcontributors.org/docs/en/bot/usage).
